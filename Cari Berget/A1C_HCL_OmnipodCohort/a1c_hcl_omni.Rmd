---
title: "A1c Analysis"
author: "Casey Sakamoto"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 5
    toc_float: yes
---

```{r setup, include=FALSE}
library(arsenal)
library(tidyverse)
library(performance)
library(knitr)

# data upload
analysis_raw <- read_csv("S:/Laura/BDC/Projects/Cari Berget/a1c_hcl_omnipod/DATA/HCLClinicalObservati_DATA_2023-06-14_1345.csv")
test = analysis_raw %>% filter(redcap_event_name == "child_bl_arm_1")
```

```{r dc and scoring, include = FALSE}
# system use/glycemic vars of interest
analysis_gly_t1 = analysis_raw %>% select(record_id, redcap_event_name,demo_c_age, gly_time_am, gly_time_am_ltd, gly_time_am_act,
                                      gly_time_mm, gly_sensorwear, gly_tdd, gly_tdd_bolus, gly_tdd_basal, gly_dailymealbolus, gly_dailybolus,
                                      gly_overrides, gly_a1c, gly_gmi, gly_sensor_mean, gly_sensor_sd, gly_sensor_u54, gly_sensor_54_69,
                                      gly_sensor_70_180, gly_sensor_181_250, gly_sensor_g250)

psy_soc_child_bl = analysis_raw %>% select(record_id, demo_c_age,redcap_event_name, c_b_header_timepoint:c_b_inspire17,
                                           ya_b_header_timepoint:ya_b_inspire17, seeds_b1:seeds_b20) %>% filter(redcap_event_name == "child_bl_arm_1")
# score surveys
# Inspire: sum then mean then mult by 25
#psy_soc_child_bl
test = psy_soc_child_bl %>% mutate(cb_inspire_total = select(., c_b_inspire1:c_b_inspire17) %>% rowMeans()*25, 
                                               ya_b_inspire_total = select(., ya_b_inspire1:ya_b_inspire17) %>% rowMeans()*25,
                                               inspire_score = ifelse(demo_c_age < 13, cb_inspire_total, ya_b_inspire_total), # INSPIRE TOTAL
                                               
                                               c_hfs_maintain = select(., c_b_hfs_behave3, c_b_hfs_behave4, c_b_hfs_behave7) %>% rowSums(),
                                               c_hfs_worry_bg = select(., c_b_hfs_worry11:c_b_hfs_worry14, c_b_hfs_worry16, c_b_hfs_worry18,
                                                                       c_b_hfs_worry19, c_b_hfs_worry22:c_b_hfs_worry23) %>% rowSums(),
                                               c_hfs_worry_soc = select(., c_b_hfs_worry15,c_b_hfs_worry17,
                                                                        c_b_hfs_worry20, c_b_hfs_worry21, c_b_hfs_worry25) %>% rowSums(),
                                               
                                               ya_hfs_maintain = select(., ya_b_hfs_behave3, ya_b_hfs_behave4, ya_b_hfs_behave7) %>% rowSums(),
                                               ya_hfs_worry_bg = select(., ya_hfs_worry_b11:ya_hfs_worry_b14, ya_hfs_worry_b16, ya_hfs_worry_b18,
                                                                       ya_hfs_worry_b19, ya_hfs_worry_b22:ya_hfs_worry_b23) %>% rowSums(),
                                               ya_hfs_worry_soc = select(., ya_hfs_worry_b15,ya_hfs_worry_b17,
                                                                        ya_hfs_worry_b20, ya_hfs_worry_b21, ya_hfs_worry_b25) %>% rowSums(),
                                               hfs_maintain = ifelse(demo_c_age < 13, c_hfs_maintain, ya_hfs_maintain),
                                               hfs_worry_bg = ifelse(demo_c_age < 13, c_hfs_worry_bg, ya_hfs_worry_bg),
                                               hfs_worry_soc = ifelse(demo_c_age < 13, c_hfs_worry_soc, ya_hfs_worry_soc), # HFS
                                               
                                               cb_paid =  select(., c_b_paid1:c_b_paid20) %>% rowSums(),
                                               cb_paid_score = (80 - cb_paid)*25/20,
                                               ya_paid =  select(., ya_b_paid1:ya_b_paid20) %>% rowSums(),
                                               ya_paid_score = (80 - ya_paid)*25/20,
                                               paid_score = ifelse(demo_c_age < 13, cb_paid_score, ya_paid_score)
                                   )  %>% select(record_id, redcap_event_name, demo_c_age, inspire_score, hfs_maintain:hfs_worry_soc,paid_score)

```

Objectives: 
1.	To describe use of the Omnipod 5 AID system and glycemic outcomes in a clinical sample of youth starting the Omnipod 5 system for their clinical care. 
2. Describe psychosocial impacts of the Omnipod 5 system in a clinical sample of youth starting Omnipod 5 for their clinical care


1.	Describe change over time in System Use and glycemic variables in Linear mixed model with the following time points: 
•	Baseline (up to 14 days prior to starting HCL)
•	1 month post HCL start
•	3 month post HCL start
•	6 month post HCL start
•	*would like p-values for difference between baseline and each time point

o	Groups: 
o	Full cohort
o	Low, middle, high baseline A1C 
	Low= ≤7%
	Middle= 7.1-8.9%
	High= 9%+
o	Age groups
	Preschool = 5.9 and younger
	Child= 6-13.9
	Adolescent= 14.0-17.9
	Young adult= 18+

o	 discontinuation defined as <10% Automated Mode use at any time point.  All patients with >10% Automated Mode use included in model at each time point. Report #s of Automated Mode discontinuers over time as well as CGM use (% Sensor Wear) for discontinuers over time
Variables:
System use variables
•	% time in Automated Mode
•	% time in Automated: Limited
•	% time in Automated: Activity
•	% time in Manual Mode
•	% Sensor wear
•	Total Daily Dose (TDD)
•	% TDD as bolus
•	% TDD as basal
•	# meal boluses per day 
•	# boluses/day
•	% overrides
Glycemic Variables:
•	HbA1c (%)
•	GMI (%)
•	Average sensor glucose value
•	Standard Deviation of Sensor Glucose Values
•	% under 54 mg/dL
•	% time sensor values 54-69 mg/dL
•	% time sensor values 70-180 mgdL
•	% time sensor values 181-250 mg/dL
•	% time sensor values > 250 mg/dL
•	Analysis for % time in ranges
o	70-180, >180, >250, <70, <54
•	NOTE: to calculate the time > 180 will need to combine the ’181-250’ data point + ‘>250’ data point
•	NOTE: to calculate the time <70, will need to combine the ‘<54’ and ’54-69’ data point
•	% Meeting ADA goals of
o	HbA1c ≤ 7.0%
o	TIR (70-180) ≥ 70% 
o	TBR (<70) < 4%
o	HbA1c ≤ 7.0%, TIR≥ 70%, TBR< 4% 

2. Psychosocial analysis: 
o	Survey data for parents 
o	INSPIRE
o	Hypoglycemia Fear Survey (HFS)
o	Problem Areas in Diabetes (PAID-PR)
o	Survey for youth
o	Hypoglycemia Fear survey (HFS)
o	Problem Areas in Diabetes (PAID)- Pediatric 
o	INSPIRE
o	SEEDS Survey (only for ages 13+)
