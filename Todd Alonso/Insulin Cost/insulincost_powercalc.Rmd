---
title: "Insulin Cost Power Calculation"
author: "Casey Sakamoto"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 2
    toc_float: yes
---

```{r setup, include=FALSE}
library(arsenal)
library(tidyverse)
library(performance)
library(knitr)
library(pwr)
library(ggplot2)

knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "S:/Laura/BDC/Projects/Todd Alonso/Waterman Alonso insulin pricing"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = "/Volumes/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
}
knitr::opts_knit$set(root.dir = home_dir)
rm(home_dir)
```

# Hypothesis

Patients with private insurance, and are based in Colorado, will observe a more significant reduction in co-payments compared to those on public insurance or those with out of state insurance.


# Outcome Measure

* Correlation between monthly copayment costs of insulin before and after implementation of HB19-1216 and HB21-1307 and:
	Type of insurance
	State of residence
* Correlation between patient/familial concerns on cost and:
	HbA1c
	Emergency department visits and hospitalizations
	Type of insurance
	Frequency of visits in the last 12 months to the BDC

# Description of Population to be Enrolled

Individuals with be eligible if they:

* Aged between 2-26 years old
* Diagnosis of Type 1 Diabetes
* Read/comprehend English or Spanish (surveys will be available in both languages)
* Currently receive care at the Barbara Davis Center


```{r pwr calc}
# mentioned the sample size could be in the range of the 100s

# change the effect size (correlations)
r = seq(.1,.8, .05)
nr = length(r)

# change the sample size
n = seq(100, 900, 50)
nn = length(n)

# obtain power
p = seq(.7, .9, .05)
np = length(p)

# obtain sample sizes
samsize <- array(numeric(nr*np), dim=c(nr,np))
for (i in 1:np){
  for (j in 1:nr){
    result <- pwr.r.test(n = NULL, r = r[j],
    sig.level = .05, power = p[i],
    alternative = "two.sided")
    samsize[j,i] <- ceiling(result$n)
  }
}

# set up graph
xrange <- range(r)
yrange <- round(range(samsize))
colors <- rainbow(length(p))
plot(xrange, yrange, type="n",
  xlab="Correlation Coefficient (r)",
  ylab="Sample Size (n)" )

# add power curves
for (i in 1:np){
  lines(r, samsize[,i], type="l", lwd=2, col=colors[i])
}

# add annotation (grid lines, title, legend)
title("Sample Size Estimation for Correlation Effect Size")
legend("topright", title="Power", as.character(p),
   fill=colors)
```

To detect a correlation coefficient of 0.1 at 0.8 power, we would need a sample size of n = 782.
To detect a correlation coefficient of 0.3 at 0.8 power, we would need a sample size of n = 194.
To detect a correlation coefficient of 0.5 at 0.8 power, we would need a sample size of n = 85.


