---
title: "DKA analysis update (Morgan Sooy & Andrea Steck)"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    theme: readable
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r setup, include=FALSE}
library(knitr)
library(dplyr)
library(lubridate)

knitr::opts_chunk$set(echo = FALSE,warning = FALSE)

knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "B:/Projects/Andrea Steck/Morgan Sooy DKA update/"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = "/Volumes/som/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
}
#knitr::opts_knit$set(root.dir = home_dir)

#setwd(home_dir)
```

```{r data, include=FALSE}
#data <- read.csv("./Data_raw/10.26.22_Sooy_FinalThesis_Dataset LP.csv", na.strings = c(""," ","."))
data <- read.csv("C:/Downtime/Orlando/Steck/10.26.22_Sooy_FinalThesis_Dataset.csv", na.strings = c(""," ",".","NULL"))
data$OnsetDate <- as.Date(data$OnsetDate, format="%m/%d/%Y")
data$Initial.research.study.visit.date <- as.Date(data$Initial.research.study.visit.date, format="%m/%d/%Y")
data$LastVisitDate <- as.Date(data$LastVisitDate, format="%m/%d/%Y")
data$fup_post_dx_mo <- floor(as.numeric(data$LastVisitDate-data$OnsetDate)/30.44)
data$ge12mopost <- ifelse(data$fup_post_dx_mo>=12,1,0)
data$ge13mopost <- ifelse(data$fup_post_dx_mo>=13,1,0)
data$ge14mopost <- ifelse(data$fup_post_dx_mo>=14,1,0)
data$ge15mopost <- ifelse(data$fup_post_dx_mo>=15,1,0)


# counts of people in any study by 12, 13, 14 months of follow-up PRIOR to T1D dx
study_data <- data %>% filter(!is.na(NewOnset_DxThroughScreeningStudy))
study_data$fup_prior_dx <- study_data$OnsetDate - study_data$Initial.research.study.visit.date
study_data$fup_prior_dx_mo <- floor(as.numeric(study_data$fup_prior_dx/30.44))
study_data$ge12moprior <- ifelse(study_data$fup_prior_dx_mo>=12,1,0)
study_data$ge13moprior <- ifelse(study_data$fup_prior_dx_mo>=13,1,0)
study_data$ge14moprior <- ifelse(study_data$fup_prior_dx_mo>=14,1,0)
study_data$ge6moprior <- ifelse(study_data$fup_prior_dx_mo>=6,1,0)
```

# Count of patients with at least 6 months followup in a study prior to T1D diagnosis

```{r echo=FALSE}
table(study_data$ge6moprior)
```

# Count of patients with at least 12 months followup in a study prior to T1D diagnosis

```{r echo=FALSE}
table(study_data$ge12moprior)
```

# Count of patients with at least 13 months followup in a study prior to T1D diagnosis

```{r echo=FALSE}
table(study_data$ge13moprior)
```

# Count of patients with at least 14 months followup in a study prior to T1D diagnosis

```{r echo=FALSE}
table(study_data$ge14moprior)
```

# Count of all patients with at least 12 months followup post T1D diagnosis

```{r echo=FALSE}
table(data$ge12mopost)
```

# Count of all patients with at least 13 months followup post T1D diagnosis

```{r echo=FALSE}
table(data$ge13mopost)
```

# Count of all patients with at least 14 months followup post T1D diagnosis

```{r echo=FALSE}
table(data$ge14mopost)
```

# Count of all patients with at least 15 months followup post T1D diagnosis

```{r echo=FALSE}
table(data$ge15mopost)
```







# Count of study patients with at least 12 months followup post T1D diagnosis

```{r echo=FALSE}
table(study_data$ge12mopost)
```

# Count of study patients with at least 13 months followup post T1D diagnosis

```{r echo=FALSE}
table(study_data$ge13mopost)
```

# Count of study patients with at least 14 months followup post T1D diagnosis

```{r echo=FALSE}
table(study_data$ge14mopost)
```

# Count of study patients with at least 15 months followup post T1D diagnosis

```{r echo=FALSE}
table(study_data$ge15mopost)
```
