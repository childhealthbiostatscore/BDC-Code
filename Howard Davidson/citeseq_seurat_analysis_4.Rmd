---
title: ""
author: "Tim Vigers & Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 5
    toc_float: yes
---

```{r setup, include=FALSE}
library(tidyverse)
library(Seurat) # need these for Differential expression testing
library(SeuratObject)
library(data.table)

# update the dfs as change (changes in first chunk of version 3 on the Lambda)
perc_express_cluster <- read.csv("S:/Laura/BDC/Projects/Howard Davidson/perc_express_cluster_TEST.csv")

# check donor cluster level
perc_express_donorcluster  <- read.csv("S:/Laura/BDC/Projects/Howard Davidson/perc_express_donorcluster_TEST.csv")
df2 = transpose(perc_express_donorcluster)
rownames(df2) = colnames(perc_express_donorcluster)

df2 = df2[-1,]
```


```{r col clusters, include = F}
df = transpose(perc_express_cluster)
rownames(df) = colnames(perc_express_cluster)

df = df[-1,]
colnames(df) = c("c0", "c1","c2","c3", "c4","c5","c6", "c7","c8","c9", "c10","c11", "c12")

c0_list = df[order(df$c0, decreasing = T),] %>% select(c0)
c1_list = df[order(df$c1, decreasing = T),] %>% select(c1)
c2_list = df[order(df$c2, decreasing = T),] %>% select(c2)
c3_list = df[order(df$c3, decreasing = T),] %>% select(c3)
c4_list = df[order(df$c4, decreasing = T),] %>% select(c4)
c5_list = df[order(df$c5, decreasing = T),] %>% select(c5)
c6_list = df[order(df$c6, decreasing = T),] %>% select(c6)
c7_list = df[order(df$c7, decreasing = T),] %>% select(c7)
c8_list = df[order(df$c8, decreasing = T),] %>% select(c8)
c9_list = df[order(df$c9, decreasing = T),] %>% select(c9)
c10_list = df[order(df$c10, decreasing = T),] %>% select(c10)
c11_list = df[order(df$c11, decreasing = T),] %>% select(c11)
c12_list = df[order(df$c12, decreasing = T),] %>% select(c12)

# get lists
c0 = head(c0_list, n = 500)
c1 = head(c1_list, n = 500)
c2 = head(c2_list, n = 500)
c3 = head(c3_list, n = 500)

c4 = head(c4_list, n = 500)
c5 = head(c5_list, n = 500)
c6 = head(c6_list, n = 500)
c7 = head(c7_list, n = 500)

c8 = head(c8_list, n = 500)
c9 = head(c9_list, n = 500)
c10 = head(c10_list, n = 500)
c11 = head(c11_list, n = 500)
c12 = head(c12_list, n = 500)


fivenum(c0_list$c0)
table(factor(c0_list$c0))

```

```{r previous output}
# Questions:
# is 100% xpress for a cluster normal? -- normal yes
# for cluster 0 ~ 100 top genes had close to 100%

# ...
# FOR PERCENT EXPRESSION BY CLUSTER (NOT AGGREGATED BY DONOR)
# Cluster 0 had a 35% expression on the 500th most expressed gene 
# Cluster 1 had a 43% expression 
# Cluster 2 had a 46% expression 
# Cluster 3 had a 42% expression
# Cluster 4 had a 48% expression
# Cluster 5 had a 45% expression
# Cluster 6 had a 37% expression
# Cluster 7 had a 44% expression
# 8- 46
# 9- 39
# 10- 37
# 11- 51
# 12- 56
# ...
```
QUESTIONS:

- Understanding of avg by donor cells then by cluster; is this still in percent expressed, or have we gone into mean express territory?
-- for percent expressed when aggregated first into donor-cluster cells then back into cluster over a quarter have 100% expressed for c0;
--------for AL627309 (first col in un transposed donor-cluster ) in  we have 11/23 subjects in cluster 0 with very small % express -- into the cluster form we have 47.8% is this the correct % we are looking for?


UPDATE: next steps similar to difacto study (emailed from kristen);
1) identify features corr w outcome -- delta, auc (coded in previous citeseq seurat analysis)
-- average by donor cells then by cluster (intersect the cluster with the donors cells -- 20% or x% perc expression)

2) pseudobulk/ elasticnet