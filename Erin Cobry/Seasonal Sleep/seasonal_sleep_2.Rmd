---
title: ""
author: "Casey Sakamoto"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: no
    toc: yes
    toc_depth: 5
    toc_float: yes
---

```{r setup, include=FALSE}
library(arsenal)
library(tidyverse)
library(performance)
library(knitr)
library(readxl)
library(redcapAPI)
# data and subj list upload
HCL_Study_Subjects = read_excel("S:/Laura/BDC/Projects/Erin Cobry/Summer vs. School Sleep/Data_Clean/HCL_Study_Subjects1.xlsx") %>% filter(!is.na(DOB))

# hcl and sleep dataset
token = read.table("S:/Laura/BDC/Projects/Erin Cobry/ADA 2022/HCL and Sleep/api_token.txt")[1,1]
rcon <- redcapConnection(url = "https://redcap.ucdenver.edu/api/",token = token)
data = exportRecords(rcon,dates = F)
ids = data$record_id
times = data$redcap_event_name
exclude = c(101,201,102,202,103,203,110,210,119,219,121,221,131,231,141,241)

# exclude everyone in exclude from data
# kids only
data = data %>% filter(!(record_id %in% exclude)) %>% filter(record_id > 199) %>% filter(!is.na(timepoint_cs)) %>% select(-c(3:37, 51:141, 160:237, 260:379 )) %>% select(-c(hypoglycemia_fear_survey_parent_timestamp:hypoglycemia_fear_survey_parent_complete))
```




```{r}
test = data %>% filter(record_id %in% HCL_Study_Subjects$Subject)
```
Completed analysis:
Summer vs school (those with both a summer and a school data point were included) 

Ideas:
Breakdown by age due to different sleep time requirements 
-	6-12 years old is 9-12 hours
-	13-18 years old is 8-10 hours
-	Average duration of sleep for each age group as descriptive results

For the same cohort as summer vs school: For parents and the child: Look at sleep diaries for the number of awakenings and the causes of awakenings 
-	Are there more overall disruptions during the school year vs summer
-	Are there more diabetes-related awakenings in the school year vs summer

For summer visits
-	Compare baseline (MDI or pump without automation) vs HCL (month 3 or 6)
o	Have different participants between the two variables. 
o	Sleep measures vs glycemic

For school year visits
-	Compare baseline (MDI or pump without automation) vs HCL (month 3 or 6)
o	Have different participants between the two variables. 
o	Sleep measures vs glycemic

. We would also like to look at sleep diaries for awakenings.

Actigraphy:
- Average total sleep time
- Average sleep efficiency
- Average WASO
- Average time in bed

Glycemic outcomes:
- % sensor values < 70 mg/dL
- % sensor values 70-180 mg/dL
- % sensor values > 180 mg/dL
- Average sensor glucose value
