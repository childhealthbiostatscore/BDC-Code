---
title: "ASK/Fr1da SARS-COV-2 ab"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: word_document
---

```{r setup, include=FALSE}
library(tableone)
library(knitr)
library(car)

knitr::opts_chunk$set(echo = FALSE,warning = FALSE)

################
# ASK analyses #
################

ask_data <- read.csv("B:\\Projects\\Marian Rewers\\ASK\\ASK Fr1da\\Data raw\\ASK dataset for Laura Feb 13 limited.csv",na.strings = c("NA",""," "))
ask_data$DM_pos <- ifelse(ask_data$MAB=="Yes" | ask_data$SBB=="Yes","YES","NO")
ask_data$DM_pos_01 <- ifelse(ask_data$DM_pos=="YES",1,
                                ifelse(!is.na(ask_data$DM_pos),0,NA))
ask_data$COVID_Infection2_01 <- ifelse(ask_data$COVID_Infection2=="Yes",1,
                                   ifelse(!is.na(ask_data$COVID_Infection2),0,NA))
ask_data$RaceEthnicity_2group <- as.factor(ifelse(ask_data$RaceEthnicity %in% c("NHW","Unknown"),"NHW","Not NHW"))
ask_data$MAB_01 <- ifelse(ask_data$MAB=="Yes",1,
                                ifelse(!is.na(ask_data$MAB),0,NA))
ask_data$SBB_01 <- ifelse(ask_data$SBB=="Yes",1,
                                ifelse(!is.na(ask_data$SBB),0,NA))

t1 <- CreateTableOne(vars=c("AgeAtScreen","DM_pos","MAB","SBB"),data=ask_data)
t1 <- as.data.frame(print(t1,exact=c("DM_pos","MAB","SBB"),nonnormal = "AgeAtScreen",printToggle = F))

t1_stratified <- CreateTableOne(vars=c("AgeAtScreen","DM_pos","MAB","SBB"),strata = "COVID_Infection2", data=ask_data)
t1_stratified <- as.data.frame(print(t1_stratified,exact=c("DM_pos","MAB","SBB"),nonnormal = "AgeAtScreen",printToggle = F))

mod1 <- glm(data=ask_data, DM_pos_01 ~ COVID_Infection2_01, family="binomial")
or1 <- exp(cbind(OR = coef(mod1), confint(mod1)))

mod3 <- glm(data=ask_data, DM_pos_01 ~ COVID_Infection2_01 + AgeAtScreen + Sex + T1D_Fam + RaceEthnicity_2group, family="binomial")
or3 <- exp(cbind(OR = coef(mod3), confint(mod3)))

mod1_mab <- glm(data=ask_data, MAB_01 ~ COVID_Infection2_01, family="binomial")
or1_mab <- exp(cbind(OR = coef(mod1_mab), confint(mod1_mab)))

mod1_sbb <- glm(data=ask_data, SBB_01 ~ COVID_Infection2_01, family="binomial")
or1_sbb <- exp(cbind(OR = coef(mod1_sbb), confint(mod1_sbb)))

mod3 <- glm(data=ask_data, DM_pos_01 ~ COVID_Infection2_01 + AgeAtScreen + Sex + T1D_Fam + RaceEthnicity_2group, family="binomial")
or3 <- exp(cbind(OR = coef(mod3), confint(mod3)))

mod3_mab <- glm(data=ask_data, MAB_01 ~ COVID_Infection2_01 + AgeAtScreen + Sex + T1D_Fam + RaceEthnicity_2group, family="binomial")
or3_mab <- exp(cbind(OR = coef(mod3_mab), confint(mod3_mab)))

mod3_sbb <- glm(data=ask_data, SBB_01 ~ COVID_Infection2_01 + AgeAtScreen + Sex + T1D_Fam + RaceEthnicity_2group, family="binomial")
or3_sbb <- exp(cbind(OR = coef(mod3_sbb), confint(mod3_sbb)))

##################
# Fr1da analyses #
##################

fr1da_data <- read.csv("B:\\Projects\\Marian Rewers\\ASK\\ASK Fr1da\\Data raw\\Fr1da dataset for Laura Feb 13 limited.csv",na.strings = c("NA",""," "))
fr1da_data$DM_pos <- ifelse(fr1da_data$MAB=="Yes" | fr1da_data$SBB=="Yes","YES","NO")
fr1da_data$DM_pos_01 <- ifelse(fr1da_data$DM_pos=="YES",1,
                                ifelse(!is.na(fr1da_data$DM_pos),0,NA))
fr1da_data$COVID_Infection_01 <- ifelse(fr1da_data$COVID_Infection =="TRUE",1,
                                   ifelse(!is.na(fr1da_data$COVID_Infection ),0,NA))
fr1da_data$MAB_01 <- ifelse(fr1da_data$MAB=="Yes",1,
                                ifelse(!is.na(fr1da_data$MAB),0,NA))
fr1da_data$SBB_01 <- ifelse(fr1da_data$SBB=="Yes",1,
                                ifelse(!is.na(fr1da_data$SBB),0,NA))

t1_fr1da <- CreateTableOne(vars=c("AgeAtScreen","DM_pos","MAB","SBB"),data=fr1da_data)
t1_fr1da <- as.data.frame(print(t1_fr1da,exact=c("DM_pos","MAB","SBB"),nonnormal = "AgeAtScreen",printToggle = F))

t1_fr1da_stratified <- CreateTableOne(vars=c("AgeAtScreen","DM_pos","MAB","SBB"),strata = "COVID_Infection", data=fr1da_data)
t1_fr1da_stratified <- as.data.frame(print(t1_fr1da_stratified,exact=c("DM_pos","MAB","SBB"),nonnormal = "AgeAtScreen",printToggle = F))

mod1_fr1da <- glm(data=fr1da_data, DM_pos_01 ~ COVID_Infection , family="binomial")
or1_fr1da <- exp(cbind(OR = coef(mod1_fr1da), confint(mod1_fr1da)))

mod1_fr1da_mab <- glm(data=fr1da_data, MAB_01 ~ COVID_Infection , family="binomial")
or1_fr1da_mab <- exp(cbind(OR = coef(mod1_fr1da_mab), confint(mod1_fr1da_mab)))

mod1_fr1da_sbb <- glm(data=fr1da_data, SBB_01 ~ COVID_Infection , family="binomial")
or1_fr1da_sbb <- exp(cbind(OR = coef(mod1_fr1da_sbb), confint(mod1_fr1da_sbb)))

mod3_fr1da <- glm(data=fr1da_data, DM_pos_01 ~ COVID_Infection  + AgeAtScreen + Sex + T1D_Fam, family="binomial")
or3_fr1da <- exp(cbind(OR = coef(mod3_fr1da), confint(mod3_fr1da)))

mod3_fr1da_mab <- glm(data=fr1da_data, MAB_01 ~ COVID_Infection  + AgeAtScreen + Sex + T1D_Fam, family="binomial")
or3_fr1da_mab <- exp(cbind(OR = coef(mod3_fr1da_mab), confint(mod3_fr1da_mab)))

mod3_fr1da_sbb <- glm(data=fr1da_data, SBB_01 ~ COVID_Infection  + AgeAtScreen + Sex + T1D_Fam, family="binomial")
or3_fr1da_sbb <- exp(cbind(OR = coef(mod3_fr1da_sbb), confint(mod3_fr1da_sbb)))
```

# ASK analyses

## Descriptive statistics, overall

```{r echo=FALSE}
kable(t1)
```

## Descriptive statistics, by COVID status

```{r echo=FALSE}
kable(t1_stratified)
```

## Unadjusted logistic regression model - MAB or SBB

```{r echo=FALSE,comment=""}
Anova(mod1,type = "III")
or1
```

## Adjusted logistic regression model - MAB or SBB

```{r echo=FALSE,comment=""}
Anova(mod3,type = "III")
or3
```

## Unadjusted logistic regression model - MAB 

```{r echo=FALSE,comment=""}
Anova(mod1_mab,type = "III")
or1_mab
```

## Adjusted logistic regression model - MAB 

```{r echo=FALSE,comment=""}
Anova(mod3_mab,type = "III")
or3_mab
```

## Unadjusted logistic regression model - SBB 

```{r echo=FALSE,comment=""}
Anova(mod1_sbb,type = "III")
or1_sbb
```

## Adjusted logistic regression model - SBB 

```{r echo=FALSE,comment=""}
Anova(mod3_sbb,type = "III")
or3_sbb
```

# Fr1da analyses

## Descriptive statistics, overall

```{r echo=FALSE}
kable(t1_fr1da)
```

## Descriptive statistics, by COVID status

```{r echo=FALSE}
kable(t1_fr1da_stratified)
```

## Unadjusted logistic regression model, MAB or SBB

```{r echo=FALSE,comment=""}
Anova(mod1_fr1da,type = "III")
or1_fr1da
```

## Adjusted logistic regression model, MAB or SBB

```{r echo=FALSE,comment=""}
Anova(mod3_fr1da,type = "III")
or3_fr1da
```

## Unadjusted logistic regression model, MAB

```{r echo=FALSE,comment=""}
Anova(mod1_fr1da_mab,type = "III")
or1_fr1da_mab
```

## Adjusted logistic regression model, MAB

```{r echo=FALSE,comment=""}
Anova(mod3_fr1da_mab,type = "III")
or3_fr1da_mab
```

## Unadjusted logistic regression model, SBB

```{r echo=FALSE,comment=""}
Anova(mod1_fr1da_sbb,type = "III")
or1_fr1da_sbb
```

## Adjusted logistic regression model, SBB

```{r echo=FALSE,comment=""}
Anova(mod3_fr1da_sbb,type = "III")
or3_fr1da_sbb
```