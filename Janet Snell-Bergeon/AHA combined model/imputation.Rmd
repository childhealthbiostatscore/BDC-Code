---
title: ""
author: "Tim Vigers & Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 2
    toc_float: yes
---

```{r setup, include=FALSE}
library(arsenal)
library(tidyverse)
library(performance)
library(knitr)
library(mice)
knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "B:/Projects"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = "/Volumes/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
}
knitr::opts_knit$set(root.dir = home_dir)
```

```{r}
load("./Janet Snell-Bergeon/AHA collaborative grant/aha_master_data.Rdata")
# Make new variables
df$smknum = as.numeric(!(df$SmkStatusV1 == "Former" | df$SmkStatusV1 == "Never"))
df$SmkPackYrsV1[df$SmkStatusV1 == "Former" | df$SmkStatusV1 == "Never"] = 0
df$smknum = df$smknum * df$SmkPackYrsV1
df$duration_cat = cut(df$durationV1,breaks = c(-Inf,23,Inf),right = F)
# Columns from Laura's model
columns_from_laura = c("StudyID",snps,"gly_P02671.7","gly_P02671.5",
                       "gly_P02671.4","gly_P02671.3","AAA01201000179.0807263.4",
                       "gly_P02679","HMDB00510161.0696402.9",
                       "AAA01201000179.0809235.7","gly_P02675.4","gly_P02675",
                       "gly_P02647","P02655","gly_P02647.1",
                       "HMDB00510161.0694436","gly_P02652","gly_P01009",
                       "gly_P01834.11","P01817","AcCa 10:3",
                       "HMDB0028822260.1378628.6","AAA01201000179.0807263.4",
                       "gly_P02671.3","gly_P02671.7","age", "onhypermedsV1",
                       "onlipidmedsV1", "ldlV1", "smknum","SmkStatusV1","race","cholV1", 
                       "duration_cat")
# Log transform some
to_transform = c("bmiV1","avediabpV1","hdlcV1","CKDepiV1","acV1",
                  "insdoseperkgV1","hba1cV1")
log_transformed = paste0("l.",sub("V1","",to_transform))
df[,log_transformed] = log(df[,to_transform])
# Subset columns
ada_data <- df[,c(columns_from_laura,log_transformed)]
# Only rows with SNP data
ada_data = ada_data[!is.na(ada_data$rs10949670),]
# Remove duplicates
ada_data = ada_data[!ada_data$StudyID %in% ada_data$StudyID[duplicated(ada_data$StudyID)],]
```

# Missingness

```{r fig.width=8,fig.height=8}
md.pattern(ada_data,rotate.names = T)
colnames(ada_data) = gsub("\\.|\\:","_",colnames(ada_data))
imputed = mice(ada_data,m = 10,seed = 1017,printFlag = F)
```
