---
title: "AHA clinical model"
author: "Tim Vigers & Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 2
    toc_float: yes
---

```{r setup, include=FALSE}
library(arsenal)
library(tidyverse)
library(performance)
library(broom)
library(knitr)
knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "B:/Projects"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = "/Volumes/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
}
knitr::opts_knit$set(root.dir = home_dir)
rm(home_dir)
```

```{r}
source("~/GitHub/shared-resources/Machine Learning/Tim - ElasticNet CV/easy_elasticnet.R")
load("./Janet Snell-Bergeon/AHA collaborative grant/aha_master_data_no_snps.Rdata")
```

# LASSO for CAC progression, using lipid lowering meds and A1c, WHR, onhypermeds

## CAC progression - LASSO without interactions

```{r include=FALSE}
selected = easy_glinternet(data = df,outcome = "CACprogV3",
                           predictors = clinical_predictors,
                           binom = T,out = "min.error")
```

```{r}
kable(selected,col.names = "Selected Variables")
```

## CAC progression - GLM using variables selected by LASSO

```{r}
vars = sub("2|Yes","",selected)
vars = gsub("V11","V1",vars)
vars = gsub("\\.","_",vars)
f = as.formula(paste0("CACprogV3~",paste0(vars,collapse = "+")))
mod = glm(f,data = df,family = "binomial")
summary(mod)
```

## Laura's First Model

![](/Users/timvigers/GitHub/BDC-Code/Janet Snell-Bergeon/AHA combined model/laurasmodel.png)
