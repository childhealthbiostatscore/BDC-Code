---
title: "Optimal Duration of GRI"
author: "Casey Sakamoto"
date: "4/14/2022"
output: html_document
---

```{r setup, include=FALSE}
library(readr)
library(knitr)
library(tidyverse)
library(ggplot2)

knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "S:/Laura/BDC/Projects/Viral Shah/GRI"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects/Viral Shah/GRI"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = "/Volumes/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects/Viral Shah/GRI"
}
knitr::opts_knit$set(root.dir = home_dir)

setwd(home_dir)
rm(home_dir)
```

```{r data import, include=FALSE}
# subjid is firstlast, columns for 7, 14, 30, 60 , 90 day gri
gri = read_csv("S:/Laura/BDC/Projects/Kaan Akturk/CGM Sampling/Data_Cleaned/gri.csv")
gri_val = c("day7_gri","day14_gri","day30_gri","day60_gri","day90_gri")

# compute correlations
gri_cor = cor(gri[,gri_val], use = "pairwise.complete.obs")

# put into data frame and compute r^2
gri_cor = as.data.frame(gri_cor[,5])
gri_cor = rename(gri_cor, "r" =`gri_cor[, 5]`)
gri_cor$r_sq = gri_cor$r^2
gri_cor$Day = factor(c("7","14","30","60","90"), levels = c("7", "14","30", "60", "90"))
```


# Background
The objective is to evaluate optimal duration of CGM data for GRI measurement. This is similar to work previously published to figure out optimal duration of CGM data for TIR and A1c (ref attached). 

# Outstanding Data Questions/Remarks
N/A

# Methods
R2 and R of GRI over 7-days, 14-days, 30-days, 60-days and 90-days vs 90 days GRI were calculated and plotted using the ggplot2 package in r. 

# Analysis
```{r analysis}
ggplot(data=gri_cor, aes(x=Day, y = r)) + 
  geom_point() +
  scale_y_continuous(name = "R", sec.axis = sec_axis(~.^2, name = "R2")) +
  theme_classic()
```

We observe a very strong linear relationship between the 7 day GRI and 90 day GRI (r = 0.892). Increasing the days to 14 from 7, we observe a 0.046 increase in the r coefficient. Increasing the days to 30 from 14 we observe a 0.029 increase in the r coefficient. Increasing the days to 60 from 30 we observe a 0.023 increase in the r coefficient.

```{r corr table}
kable(gri_cor[,1:2], digits = 3)
```