---
title: "Temporal development of T-cell repertoires"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:   
  html_document:
    number_sections: yes
    theme: readable
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=F}
# required libraries
library(purrr)
library(tableone)
library(dplyr)
library(plyr)
library(zoo)
library(nlme)
library(lme4)
library(emmeans)
library(knitr)
library(car)
library(tidyr)
```

```{r, include=F}
knitr::opts_chunk$set(echo = FALSE,warning = FALSE)

home_dir = ifelse(.Platform$OS.type != "unix","T:\\",
                  "/Volumes/som/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects")
knitr::opts_knit$set(root.dir = home_dir)

# read in seroconversion visit data
seroconvert <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\Aab+ visits.csv",na.strings = c(""," ","N/A"))
# IDs don't seem to match

# data for fig 1b
dat1 <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig_1b_s2.csv",na.strings = c(""," ","X"))
# wide to long
dat1_long <- dat1 %>% gather(tp,clonality,-c(ID,Group))
dat1_long$time <- ifelse(dat1_long$tp=="TP.1",1,
                         ifelse(dat1_long$tp=="TP.2",2,
                                ifelse(dat1_long$tp=="TP.3",3,4)))
dat1_long$time <- as.factor(dat1_long$time)
dat1_long$l.clonality <- log(dat1_long$clonality)
dat1_long <- arrange(dat1_long,ID,time)
dat1_long_case <- dat1_long %>% filter(Group=="CASE")
dat1_long_control <- dat1_long %>% filter(Group=="CON")

# data for fig 1c
dat1_age <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig_1b_s2_age.csv",na.strings = c(""," ","X"))
dat1_age$l.clonality <- log(dat1_age$Clonality)
dat1_age$TP <- as.factor(dat1_age$TP)
dat1_age_case <- dat1_age %>% filter(Group=="CASE")
dat1_age_control <- dat1_age %>% filter(Group=="CON")

# data for fig 4a
dat4a_aet <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig 4a %AET.csv",na.strings = c(""," ","X"))
dat4a_aet$Time.point <- as.factor(dat4a_aet$Time.point)
dat4a_aet$l.templates <- log(dat4a_aet$X..Templates)
dat4a_aet$l.unique.CDR3s <- log(dat4a_aet$X..Unique.CDR3s)

dat4a_set <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig 4a S%ET.csv",na.strings = c(""," ","X"))
dat4a_set$Time.point <- as.factor(dat4a_set$Time.point)
dat4a_set$l.templates <- log(dat4a_set$X..Templates)
dat4a_set$l.unique.CDR3s <- log(dat4a_set$X..Unique.CDR3s)

dat4a_sat <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig 4a SA%T.csv",na.strings = c(""," ","X"))
dat4a_sat$Time.point <- as.factor(dat4a_sat$Time.point)
dat4a_sat$l.templates <- log(dat4a_sat$X..Templates)
dat4a_sat$l.unique.CDR3s <- log(dat4a_sat$X..Unique.CDR3s)

dat4a_sae <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig 4a SAE%.csv",na.strings = c(""," ","X"))
dat4a_sae$Time.point <- as.factor(dat4a_sae$Time.point)
dat4a_sae$l.templates <- log(dat4a_sae$X..Templates)
dat4a_sae$l.unique.CDR3s <- log(dat4a_sae$X..Unique.CDR3s)

# read in data for fig s1
dats1 <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig s1.csv",na.strings = c(""," ","X"))
dats1_long <- dats1 %>% gather(tp,Productive.template,-c(ID,Group))
dats1_long$time <- ifelse(dats1_long$tp=="Productive.template.1",1,
                         ifelse(dats1_long$tp=="Productive.template.2",2,
                                ifelse(dats1_long$tp=="Productive.template.3",3,4)))
dats1_long$time <- as.factor(dats1_long$time)
dats1_long_case <- dats1_long %>% filter(Group=="CASE")
dats1_long_control <- dats1_long %>% filter(Group=="CON")

# fig S6
dats6_lqs <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig s6a %LQS.csv",na.strings = c(""," ","X"))
dats6_lqs$Time.point <- as.factor(dats6_lqs$Time.point)
dats6_lqs$l.templates <- log(dats6_lqs$X..Templates)
dats6_lqs$l.unique.CDR3s <- log(dats6_lqs$X..Unique.CDR3s)

dats6_sqs <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig s6a S%QS.csv",na.strings = c(""," ","X"))
dats6_sqs$Time.point <- as.factor(dats6_sqs$Time.point)
dats6_sqs$l.templates <- log(dats6_sqs$X..Templates)
dats6_sqs$l.unique.CDR3s <- log(dats6_sqs$X..Unique.CDR3s)

dats6_sls <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig s6a SL%S.csv",na.strings = c(""," ","X"))
dats6_sls$Time.point <- as.factor(dats6_sls$Time.point)
dats6_sls$l.templates <- log(dats6_sls$X..Templates)
dats6_sls$l.unique.CDR3s <- log(dats6_sls$X..Unique.CDR3s)

dats6_slq <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig s6a SLQ%.csv",na.strings = c(""," ","X"))
dats6_slq$Time.point <- as.factor(dats6_slq$Time.point)
dats6_slq$l.templates <- log(dats6_slq$X..Templates)
dats6_slq$l.unique.CDR3s <- log(dats6_slq$X..Unique.CDR3s)

# fig S7
dats7_iag <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig s7a %IAG.csv",na.strings = c(""," ","X"))
dats7_iag$Time.point <- as.factor(dats7_iag$Time.point)
dats7_iag$l.templates <- log(dats7_iag$X..Templates)
dats7_iag$l.unique.CDR3s <- log(dats7_iag$X..Unique.CDR3s)

dats7_sag <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig s7a S%AG.csv",na.strings = c(""," ","X"))
dats7_sag$Time.point <- as.factor(dats7_sag$Time.point)
dats7_sag$l.templates <- log(dats7_sag$X..Templates)
dats7_sag$l.unique.CDR3s <- log(dats7_sag$X..Unique.CDR3s)

dats7_sig <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig s7a SI%G.csv",na.strings = c(""," ","X"))
dats7_sig$Time.point <- as.factor(dats7_sig$Time.point)
dats7_sig$l.templates <- log(dats7_sig$X..Templates)
dats7_sig$l.unique.CDR3s <- log(dats7_sig$X..Unique.CDR3s)

dats7_sia <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig s7a SIA%.csv",na.strings = c(""," ","X"))
dats7_sia$Time.point <- as.factor(dats7_sia$Time.point)
dats7_sia$l.templates <- log(dats7_sia$X..Templates)
dats7_sia$l.unique.CDR3s <- log(dats7_sia$X..Unique.CDR3s)

dats7_iag <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig s7a IAG%.csv",na.strings = c(""," ","X"))
dats7_iag$Time.point <- as.factor(dats7_iag$Time.point)
dats7_iag$l.templates <- log(dats7_iag$X..Templates)
dats7_iag$l.unique.CDR3s <- log(dats7_iag$X..Unique.CDR3s)

dats7_agg <- read.csv("T:\\Aaron Michels\\Temporal development of T-cell repertoires\\Data raw\\fig s7a AGG%.csv",na.strings = c(""," ","X"))
dats7_agg$Time.point <- as.factor(dats7_agg$Time.point)
dats7_agg$l.templates <- log(dats7_agg$X..Templates)
dats7_agg$l.unique.CDR3s <- log(dats7_agg$X..Unique.CDR3s)
```

# Methods

In general, mixed-effects models were used to compare groups and time points while accounting for the correlation of multiple measures within a participant. Tukey's Honestly Significant Difference test was used to control for multiple testing when performing pairwise comparisons.  All analyses were performed using R version 4.1 (R Core Team, Vienna).  Specific information about the models corresponding to each of the figures is below.

Figure 1b: a mixed-effects model of ln(clonality) vs time was used to compare time points with all samples combined and after stratifying by cases and controls.

Figure S2: a mixed-effects model of ln(clonality) vs time, group, and the interaction of time and group was used to compare groups at each time point.

Figure 1c: a mixed-effects model of ln(clonality) vs. age was used to examine this association with all time points combined.

Figure 4a: mixed-effects models of template number and diversity with interaction between group and time were used to test whether the patterns of change in the two groups were significantly different.

Figure S1a: a mixed-effects model of the number of productive templates was used to compare groups with all time points combined.

Figure S1b: a mixed-effects model of the number of productive templates and an interaction between group and time was used to compare groups at each time point.

Figure S6a: mixed-effects models of template number and diversity with interaction between group and time were used to test whether the patterns of change in the two groups were significantly different.

Figure S7a: mixed-effects models of template number and diversity with interaction between group and time were used to test whether the patterns of change in the two groups were significantly different.

# Questions/Comments

1.  In figure 1, clonality was log-transformed to improve the fit of the model (see normal Q-Q plot).  I considered log-transformation for the other models but it either was not needed or did not improve the fit.  The diagnostic plots for figure 1 are still not ideal - we could consider other transformations, but that would reduce the interpretability of the results.

2.  Figure 2c - after looking at the data more carefully, the current analysis is fine so I didn't do any new analyses with those data.

3.  In the data for Figure S1, there were no participant ID so I assumed that each row corresponded to a participant.  Let me know if that isn't correct.

# Results

General comments for all results:

1.  A p-value of 0 should be interpreted as <0.001 due to rounding.
2.  In the tables of means, "emmean" means "estimated marginal mean" which is just the mean for the group and/or time point derived from the model.
3.  For the most part,  you can ignore the plots - these are diagnostic plots of model fit.

## Figure 1b - all samples

The p-value for "tp" in the table of type 3 tests of fixed effects tests whether there was a significant change over time.

```{r, echo=FALSE, message=FALSE}
mod <- lme(l.clonality ~ tp,random=~1|ID,data = dat1_long,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,"tp")
mod_pairs <-  pairs(mod_means,adjust="tukey")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 1b - controls

The p-value for "tp" in the table of type 3 tests of fixed effects tests whether there was a significant change over time.

```{r, echo=FALSE, message=FALSE}
mod <- lme(l.clonality ~ tp,random=~1|ID,data = dat1_long_control,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,"tp")
mod_pairs <-  pairs(mod_means,adjust="tukey")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 1b - cases

The p-value for "tp" in the table of type 3 tests of fixed effects tests whether there was a significant change over time.

```{r, echo=FALSE, message=FALSE}
mod <- lme(l.clonality ~ tp,random=~1|ID,data = dat1_long_case,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,"tp")
mod_pairs <-  pairs(mod_means,adjust="tukey")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S2 - interaction of group and time

The p-value for "Group:time" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(l.clonality ~ Group*time,random=~1|ID,data = dat1_long,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Group*time)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Group")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S2 - model without interaction of group and time

The p-value for "Group" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups averaged across time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(l.clonality ~ Group + time,random=~1|ID,data = dat1_long,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Group)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Group")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 1c - all samples

The p-value for "Age" in the table of type 3 tests of fixed effects tests whether there was a significant association between age and ln(clonality), with all time points combined.

```{r, echo=FALSE, message=FALSE}
mod <- lme(l.clonality ~ Age,random=~1|ID,data = dat1_age,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 1c - controls

The p-value for "Age" in the table of type 3 tests of fixed effects tests whether there was a significant association between age and ln(clonality), with all time points combined.

```{r, echo=FALSE, message=FALSE}
mod <- lme(l.clonality ~ Age,random=~1|ID,data = dat1_age_control,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 1c - cases

The p-value for "Age" in the table of type 3 tests of fixed effects tests whether there was a significant association between age and ln(clonality), with all time points combined.

```{r, echo=FALSE, message=FALSE}
mod <- lme(l.clonality ~ Age ,random=~1|ID,data = dat1_age_case,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - *AET templates, with interaction of group by time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dat4a_aet,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - *AET templates, no interaction of group by time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point + Diagnosis,random=~1|Patient,data = dat4a_aet,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - *AET templates, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_aet[dat4a_aet$Diagnosis=="Case",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - *AET templates, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_aet[dat4a_aet$Diagnosis=="Control",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - *AET diversity, with interaction of group by time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dat4a_aet,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))

```

## Figure 4a - *AET diversity, no interaction of group by time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point + Diagnosis,random=~1|Patient,data = dat4a_aet,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - *AET diversity, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_aet[dat4a_aet$Diagnosis=="Case",]
mod <- lme(X..Unique.CDR3s ~ Time.point ,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - *AET diversity, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_aet[dat4a_aet$Diagnosis=="Control",]
mod <- lme(X..Unique.CDR3s ~ Time.point ,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - S*ET templates, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dat4a_set,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - S*ET templates, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point + Diagnosis,random=~1|Patient,data = dat4a_set,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - S*ET templates, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_set[dat4a_set$Diagnosis=="Case",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - S*ET templates, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_set[dat4a_set$Diagnosis=="Control",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - S*ET diversity, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dat4a_set,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - S*ET diversity, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point + Diagnosis,random=~1|Patient,data = dat4a_set,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - S*ET diversity, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_set[dat4a_set$Diagnosis=="Case",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - S*ET diversity, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_set[dat4a_set$Diagnosis=="Control",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - SA*T templates, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dat4a_sat,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - SA*T templates, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point + Diagnosis,random=~1|Patient,data = dat4a_sat,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - SA*T templates, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_sat[dat4a_sat$Diagnosis=="Case",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - SA*T templates, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_sat[dat4a_sat$Diagnosis=="Control",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - SA*T diversity, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dat4a_sat,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - SA*T diversity, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point + Diagnosis,random=~1|Patient,data = dat4a_sat,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - SA*T diversity, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_sat[dat4a_sat$Diagnosis=="Case",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - SA*T diversity, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dat4a_sat[dat4a_sat$Diagnosis=="Control",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure 4a - SAE* templates, with interaction of group and time

The SAE* models would not converge due to sample size.

```{r, echo=FALSE, message=FALSE}
# mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dat4a_sae,na.action = na.omit)
# mod_anova <- anova.lme(mod, type="marginal")
# mod_means <- emmeans(mod,~Time.point*Diagnosis)
# mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")
# 
# kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
# kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
# kable(mod_pairs,caption="Pair-wise comparisons between time points.",format.args = list(scientific = FALSE))
# 
# qqnorm(resid(mod))
# qqline(resid(mod))
```

## Figure 4a - SAE* diversity, with interaction of group and time

The SAE* models would not converge due to sample size.

```{r, echo=FALSE, message=FALSE}
# mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dat4a_sae,na.action = na.omit)
# mod_anova <- anova.lme(mod, type="marginal")
# mod_means <- emmeans(mod,~Time.point*Diagnosis)
# mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")
# 
# kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
# kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
# kable(mod_pairs,caption="Pair-wise comparisons between time points.",format.args = list(scientific = FALSE))
# 
# qqnorm(resid(mod))
# qqline(resid(mod))
```

## Figure S1a - all samples, combined time points

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(Productive.template ~ Group,random=~1|ID,data = dats1_long,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,"Group")
mod_pairs <-  pairs(mod_means,adjust="tukey")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S1b - all samples, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(Productive.template ~ Group*time,random=~1|ID,data = dats1_long,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Group*time)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Group")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S1b - all samples, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(Productive.template ~ Group + time,random=~1|ID,data = dats1_long,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Group)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Group")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - *LQS templates, with interaction of group and time

Sample size was too small for the *LQS models to converge.

```{r, echo=FALSE, message=FALSE}
# mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dats6_lqs,na.action = na.omit)
# mod_anova <- anova.lme(mod, type="marginal")
# mod_means <- emmeans(mod,~Time.point*Diagnosis)
# mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")
# 
# kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
# kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
# kable(mod_pairs,caption="Pair-wise comparisons between time points.",format.args = list(scientific = FALSE))
# 
# qqnorm(resid(mod))
# qqline(resid(mod))
```

## Figure S6a - *LQS diversity, with interaction of group and time

Sample size was too small for the *LQS models to converge.

```{r, echo=FALSE, message=FALSE}
# mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dats6_lqs,na.action = na.omit)
# mod_anova <- anova.lme(mod, type="marginal")
# mod_means <- emmeans(mod,~Time.point*Diagnosis)
# mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")
# 
# kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
# kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
# kable(mod_pairs,caption="Pair-wise comparisons between time points.",format.args = list(scientific = FALSE))
# 
# qqnorm(resid(mod))
# qqline(resid(mod))

```

## Figure S6a - S*QS templates, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dats6_sqs,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - S*QS templates, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point + Diagnosis,random=~1|Patient,data = dats6_sqs,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - S*QS templates, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_sqs[dats6_sqs$Diagnosis=="Case",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - S*QS templates, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_sqs[dats6_sqs$Diagnosis=="Control",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - S*QS diversity, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dats6_sqs,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))

```

## Figure S6a - S*QS diversity, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point + Diagnosis,random=~1|Patient,data = dats6_sqs,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))

```

## Figure S6a - S*QS diversity, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_sqs[dats6_sqs$Diagnosis=="Case",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))

```

## Figure S6a - S*QS diversity, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_sqs[dats6_sqs$Diagnosis=="Control",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))

```

## Figure S6a - SL*S templates, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dats6_sls,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SL*S templates, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point + Diagnosis,random=~1|Patient,data = dats6_sls,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SL*S templates, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_sls[dats6_sls$Diagnosis=="Case",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SL*S templates, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_sls[dats6_sls$Diagnosis=="Control",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SL*S diversity, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dats6_sls,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))

```

## Figure S6a - SL*S diversity, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point + Diagnosis,random=~1|Patient,data = dats6_sls,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SL*S diversity, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_sls[dats6_sls$Diagnosis=="Case",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SL*S diversity, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_sls[dats6_sls$Diagnosis=="Control",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SLQ* templates, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dats6_slq,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SLQ* templates, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point + Diagnosis,random=~1|Patient,data = dats6_slq,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SLQ* templates, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_slq[dats6_slq$Diagnosis=="Case",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SLQ* templates, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_slq[dats6_slq$Diagnosis=="Control",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SLQ* diversity, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dats6_slq,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))

```

## Figure S6a - SLQ* diversity, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point + Diagnosis,random=~1|Patient,data = dats6_slq,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SLQ* diversity, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_slq[dats6_slq$Diagnosis=="Case",]
mod <- lme(X..Unique.CDR3s ~ Time.point ,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S6a - SLQ* diversity, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats6_slq[dats6_slq$Diagnosis=="Control",]
mod <- lme(X..Unique.CDR3s ~ Time.point ,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - *IAG templates, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_iag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - *IAG templates, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point + Diagnosis,random=~1|Patient,data = dats7_iag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - *IAG templates, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_iag[dats7_iag$Diagnosis=="Case",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - *IAG templates, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_iag[dats7_iag$Diagnosis=="Control",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - *IAG diversity, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_iag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - *IAG diversity, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point + Diagnosis,random=~1|Patient,data = dats7_iag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - *IAG diversity, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_iag[dats7_iag$Diagnosis=="Case",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - *IAG diversity, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_iag[dats7_iag$Diagnosis=="Control",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - S*AG templates, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_sag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - S*AG templates, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point + Diagnosis,random=~1|Patient,data = dats7_sag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - S*AG templates, cases only 

The p-value for "Time point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_sag[dats7_sag$Diagnosis=="Case",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - S*AG templates, controls only 

The p-value for "Time point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_sag[dats7_sag$Diagnosis=="Control",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - S*AG diversity, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_sag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - S*AG diversity, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point + Diagnosis,random=~1|Patient,data = dats7_sag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - S*AG diversity, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_sag[dats7_sag$Diagnosis=="Case",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - S*AG diversity, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_sag[dats7_sag$Diagnosis=="Control",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - SI*G templates, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_sig,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - SI*G templates, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point + Diagnosis,random=~1|Patient,data = dats7_sig,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - SI*G templates, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_sig[dats7_sig$Diagnosis=="Case",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - SI*G templates, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_sig[dats7_sig$Diagnosis=="Control",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - SI*G diversity, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_sig,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - SI*G diversity, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point + Diagnosis,random=~1|Patient,data = dats7_sig,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - SI*G diversity, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_sig[dats7_sig$Diagnosis=="Case",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - SI*G diversity, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_sig[dats7_sig$Diagnosis=="Control",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - SIA* templates, with interaction of group and time

SIA* models would not converge due to sample size.

```{r, echo=FALSE, message=FALSE}
# mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_sia,na.action = na.omit)
# mod_anova <- anova.lme(mod, type="marginal")
# mod_means <- emmeans(mod,~Time.point*Diagnosis)
# mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")
# 
# kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
# kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
# kable(mod_pairs,caption="Pair-wise comparisons between time points.",format.args = list(scientific = FALSE))
# 
# qqnorm(resid(mod))
# qqline(resid(mod))
```

## Figure S7a - SIA* diversity, with interaction of group and time

SIA* models would not converge due to sample size.

```{r, echo=FALSE, message=FALSE}
# mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_sia,na.action = na.omit)
# mod_anova <- anova.lme(mod, type="marginal")
# mod_means <- emmeans(mod,~Time.point*Diagnosis)
# mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")
# 
# kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
# kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
# kable(mod_pairs,caption="Pair-wise comparisons between time points.",format.args = list(scientific = FALSE))
# 
# qqnorm(resid(mod))
# qqline(resid(mod))

```

## Figure S7a - IAG* templates, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_iag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - IAG* templates, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point + Diagnosis,random=~1|Patient,data = dats7_iag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - IAG* templates, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_iag[dats7_iag$Diagnosis=="Case",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - IAG* templates, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_iag[dats7_iag$Diagnosis=="Control",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - IAG* diversity, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_iag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - IAG* diversity, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point + Diagnosis,random=~1|Patient,data = dats7_iag,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - IAG* diversity, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_iag[dats7_iag$Diagnosis=="Case",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - IAG* diversity, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_iag[dats7_iag$Diagnosis=="Control",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - AGG* templates, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_agg,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - AGG* templates, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Templates ~ Time.point + Diagnosis,random=~1|Patient,data = dats7_agg,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - AGG* templates, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_agg[dats7_agg$Diagnosis=="Case",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - AGG* templates, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_agg[dats7_agg$Diagnosis=="Control",]
mod <- lme(X..Templates ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - AGG* diversity, with interaction of group and time

The p-value for "Time.point:Diagnosis" (i.e., the group by time interaction) in the table of type 3 tests of fixed effects tests whether there was a significant difference in change over time in the two groups.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point*Diagnosis,random=~1|Patient,data = dats7_agg,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point*Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - AGG* diversity, no interaction of group and time

The p-value for "Diagnosis" in the table of type 3 tests of fixed effects tests whether there was a significant difference between groups, averaged over time points.

```{r, echo=FALSE, message=FALSE}
mod <- lme(X..Unique.CDR3s ~ Time.point + Diagnosis,random=~1|Patient,data = dats7_agg,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Diagnosis)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Diagnosis")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Group means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between groups.",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - AGG* diversity, cases only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_agg[dats7_agg$Diagnosis=="Case",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```

## Figure S7a - AGG* diversity, controls only

The p-value for "Time.point" in the table of type 3 tests of fixed effects tests whether there was a significant difference between time points.

```{r, echo=FALSE, message=FALSE}
keep <- dats7_agg[dats7_agg$Diagnosis=="Control",]
mod <- lme(X..Unique.CDR3s ~ Time.point,random=~1|Patient,data = keep,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")
mod_means <- emmeans(mod,~Time.point)
mod_pairs <-  pairs(mod_means,adjust="tukey",simple="Time.point")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
kable(mod_means,caption="Time point means.",format.args = list(scientific = FALSE))
kable(mod_pairs,caption="Pair-wise comparisons between time points",format.args = list(scientific = FALSE))

qqnorm(resid(mod))
qqline(resid(mod))
```