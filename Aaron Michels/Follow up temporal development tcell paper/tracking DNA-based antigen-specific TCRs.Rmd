---
title: "Tracking DNA-based antigen-specific TCRs"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:   
  html_document:
    number_sections: yes
    theme: readable
    toc: yes
    toc_depth: 3
    toc_float: yes
---

```{r setup, include=FALSE}
# required libraries
library(purrr)
library(tableone)
library(dplyr)
library(plyr)
library(zoo)
library(nlme)
library(lme4)
library(emmeans)
library(knitr)
library(car)
library(tidyr)
library(stringr)
knitr::opts_chunk$set(echo = FALSE)
if(Sys.info()["sysname"] == "Windows"){
  home_dir = "B:/Projects"
} else if (Sys.info()["sysname"] == "Linux"){
  home_dir = "~/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects"
} else if (Sys.info()["sysname"] == "Darwin"){
  home_dir = "/Volumes/BDC/Projects"
}
knitr::opts_knit$set(root.dir = home_dir)
```

```{r, include=F}
setwd(home_dir)
# data for fig 2a
dat2a <- read.csv("/Volumes/BDC/Projects/Aaron Michels/Follow up temporal development T-cell paper/Data raw/fig2a.csv",na.strings = c(""," ","X"))

# data for fig 2b
dat2b <- read.csv("/Volumes/BDC/Projects/Aaron Michels/Follow up temporal development T-cell paper/Data raw/fig2b.csv",na.strings = c(""," ","X"))

# data for fig 2c
dat2c <- read.csv("/Volumes/BDC/Projects/Aaron Michels/Follow up temporal development T-cell paper/Data raw/fig2c.csv",na.strings = c(""," ","X"))

# data for fig 6a
dat6a <- read.csv("/Volumes/BDC/Projects/Aaron Michels/Follow up temporal development T-cell paper/Data raw/fig6a.csv",na.strings = c(""," ","X"))

# data for fig 6b
dat6b <- read.csv("/Volumes/BDC/Projects/Aaron Michels/Follow up temporal development T-cell paper/Data raw/fig6b.csv",na.strings = c(""," ","X"))
```

# Methods

All analyses were performed using R version 4.1 (R Core Team, Vienna).  Specific information about the models corresponding to each of the figures is below.

Figure 2a: mixed-effects models were used to test the association of templates and age.

Figure 2b: mixed-effects models were used to test the association of templates and age.

Figure 2c: linear models were used to test the association of templates and age.

# Questions/Comments

# Results

General comments for all results:

1.  A p-value of 0 should be interpreted as <0.001 due to rounding.
2.  In the tables of means, "emmean" means "estimated marginal mean" which is just the mean for the group and/or time point derived from the model.

## Figure 2a

### All viral

The p-value for "Age..yrs." in the table of type 3 tests of fixed effects tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lme(Viral.TCRβ.templates ~ Age..yrs.,random=~1|Pt.ID,data = dat2a,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### Influenza

The p-value for "Age..yrs." in the table of type 3 tests of fixed effects tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lme(Flu.TCRβ.templates ~ Age..yrs.,random=~1|Pt.ID,data = dat2a,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### EBV

The p-value for "Age..yrs." in the table of type 3 tests of fixed effects tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lme(EBV.TCRβ.templates ~ Age..yrs.,random=~1|Pt.ID,data = dat2a,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### CMV

The p-value for "Age..yrs." in the table of type 3 tests of fixed effects tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lme(CMV.TCRβ.templates ~ Age..yrs.,random=~1|Pt.ID,data = dat2a,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### ADV

The p-value for "Age..yrs." in the table of type 3 tests of fixed effects tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lme(ADV.TCRβ.templates ~ Age..yrs.,random=~1|Pt.ID,data = dat2a,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

## Figure 2b

### All viral

The p-value for "Age..yrs." in the table of type 3 tests of fixed effects tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lme(Viral.TCRβ.templates ~ Age..yrs.,random=~1|Pt.ID,data = dat2b,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### Influenza

The p-value for "Age..yrs." in the table of type 3 tests of fixed effects tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lme(Flu.TCRβ.templates ~ Age..yrs.,random=~1|Pt.ID,data = dat2b,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### EBV

The p-value for "Age..yrs." in the table of type 3 tests of fixed effects tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lme(EBV.TCRβ.templates ~ Age..yrs.,random=~1|Pt.ID,data = dat2b,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### CMV

The p-value for "Age..yrs." in the table of type 3 tests of fixed effects tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lme(CMV.TCRβ.templates ~ Age..yrs.,random=~1|Pt.ID,data = dat2b,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### ADV

The p-value for "Age..yrs." in the table of type 3 tests of fixed effects tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lme(ADV.TCRβ.templates ~ Age..yrs.,random=~1|Pt.ID,data = dat2b,na.action = na.omit)
mod_anova <- anova.lme(mod, type="marginal")

kable(mod_anova,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

## Figure 2c

### All viral

The p-value (in column labeled "Pr(>|t|)") for "Age..yrs." tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lm(Viral.TCRβ.templates ~ Age..yrs.,data = dat2c,na.action = na.omit)

kable(summary(mod)$coefficients,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### Influenza

The p-value (in column labeled "Pr(>|t|)") for "Age..yrs." tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lm(Flu.TCRβ.templates ~ Age..yrs.,data = dat2c,na.action = na.omit)

kable(summary(mod)$coefficients,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### EBV

The p-value (in column labeled "Pr(>|t|)") for "Age..yrs." tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lm(EBV.TCRβ.templates ~ Age..yrs.,data = dat2c,na.action = na.omit)

kable(summary(mod)$coefficients,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### CMV

The p-value (in column labeled "Pr(>|t|)") for "Age..yrs." tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lm(CMV.TCRβ.templates ~ Age..yrs.,data = dat2c,na.action = na.omit)

kable(summary(mod)$coefficients,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### ADV

The p-value (in column labeled "Pr(>|t|)") for "Age..yrs." tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lm(ADV.TCRβ.templates ~ Age..yrs.,data = dat2c,na.action = na.omit)

kable(summary(mod)$coefficients,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

## Figure 6a

### Unique TCRs

The p-value (in column labeled "Pr(>|t|)") for "Age.Dx..yrs." tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lm(X..Unique.TCRs ~ Age.Dx..yrs.,data = dat6a,na.action = na.omit)

kable(summary(mod)$coefficients,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### Disease-associated TCR templates

The p-value (in column labeled "Pr(>|t|)") for "Age.Dx..yrs." tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lm(X..TCRβ.templates ~ Age.Dx..yrs.,data = dat6a,na.action = na.omit)

kable(summary(mod)$coefficients,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

## Figure 6b

### Unique TCRs

The p-value (in column labeled "Pr(>|t|)") for "Age.Dx..yrs." tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lm(X..Unique.TCRs ~ Age.Dx..yrs.,data = dat6b,na.action = na.omit)

kable(summary(mod)$coefficients,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```

### Disease-associated TCR templates

The p-value (in column labeled "Pr(>|t|)") for "Age.Dx..yrs." tests whether there was a significant association with age.

```{r, echo=FALSE, message=FALSE}
mod <- lm(X..TCRβ.templates ~ Age.Dx..yrs.,data = dat6b,na.action = na.omit)

kable(summary(mod)$coefficients,caption="Type 3 tests of fixed effects.",format.args = list(scientific = FALSE))
```