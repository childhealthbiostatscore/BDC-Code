---
title: "Biosample proposal power calculations"
author: "Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=F}
# required libraries
library(purrr)
library(tableone)
library(dplyr)
library(plyr)
library(zoo)
library(nlme)
library(lme4)
library(emmeans)
library(knitr)
library(car)
library(simr)
```

```{r, include=F}
# read in data
dat <- read.csv("/Volumes/BDC/Projects/Aaron Michels/Collaborative research using biosamples proposal/sample data for power calculation.csv",
                 na.strings = c("NA"," ","","N/R"))
dat$PPI.CD4.TCRs.Present <- ifelse(dat$PPI.CD4.TCRs.Present==2,1,dat$PPI.CD4.TCRs.Present)

# note that this is testing the interaction, not difference at any time point
mod <- glmer(PPI.CD4.TCRs.Present ~ Case_control*Sample.Timepoint +
    (1|Dummy.ID), data = dat, family = binomial)
summary(mod)$coef

doTest(mod, fixed("Case_controlcontrol:Sample.Timepoint"))
fixef(mod)["Case_controlcontrol:Sample.Timepoint"] <- -0.44
powerSim(mod, fixed("Case_controlcontrol:Sample.Timepoint","z"), nsim=50)
powerCurve(mod, test = fixed("Case_controlcontrol:Sample.Timepoint"))
powerCurve(mod, fixed("Case_controlcontrol:Sample.Timepoint","z"), nsim=50)

```
