---
title: "Daily Predictors for Diabetes Management"
author: "Tim Vigers & Laura Pyle"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 2
    toc_float: yes
---

```{r setup, include=FALSE}
library(arsenal)
library(skimr)
library(knitr)
library(tidyverse)
library(lubridate)
library(redcapAPI)
knitr::opts_chunk$set(echo = F)
home_dir = ifelse(.Platform$OS.type != "unix","T:/",
                  "/mnt/UCD/PEDS/RI Biostatistics Core/Shared/Shared Projects/Laura/BDC/Projects")
knitr::opts_knit$set(root.dir = home_dir)
```

```{r api,cache=TRUE}
api = read.table("./Laurel Messer/Daily Predictors/api_token")[1,1]
rcon <- redcapConnection(url="https://redcap.ucdenver.edu/api/", token=api)
data <- exportRecords(rcon,batch.size = 10,factors = T,checkboxLabels = F)
```

```{r clean data}
# Combine race columns
race_cols = paste0("pt_race___",1:6)
races = c("White","Black or African American","American Indian or Alaskan Native",
          "Asian","Native Hawaiian or Pacific Islander","Other")
data$race = apply(data[,race_cols], 1, function(r){
    paste0(races[which(r == "Checked")],collapse = ", ")
})
# Calculate age and duration
data$age = as.numeric(ymd(data$pt_visit_date) - ymd(data$pt_dob))/365.25
data$duration = as.numeric(ymd(data$pt_visit_date) - ymd(data$dxdate))/365.25
```

# Participant Characteristics

```{r table 1, results = 'asis'}
# Get first row for each person
demographics = data %>% group_by(record_id) %>% filter(row_number() == 1)
# Table 
t1 = tableby(~ age + duration + pt_a1c + pt_baseline1 + pt_baseline5 + 
               pt_gender + race + pt_eth + p1_hedu + 
               p2_hedu,demographics)
# Labels
new_labels = list(age = "Age", duration = "Diabetes Duration", pt_a1c = "Baseline HbA1c",
                  pt_baseline1 = "Pump Hx",pt_baseline5 = "CGM Hx",
                  pt_gender = "Gender", race = "Race", pt_eth = "Ethnicity", 
                  p1_hedu = "Parent 1 Education", p2_hedu = "Parent 2 Education")
summary(t1,labelTranslations = new_labels)
```

# Regularization (LASSO) Results

```{r lasso df}

```

# Questions for Laurel and Emily

1. How should we combine levels of race and parent education? White vs. non-white? Above a bachelor's degree vs. bachelor's and below?
